{% extends layout_path %}
{% load static %}
{% block title %}Hardware Shop - Sales Analysis{% endblock %}

{% block page_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Fetch Dashboard Analysis
    fetch("/admin_api/hardware-dashboard-analysis/")
      .then(res => res.json())
      .then(data => {
        // Fill daily stats
        document.getElementById("today-orders").innerText = data.daily_orders;
        document.getElementById("today-sales").innerText = "₹" + data.daily_sales;

        // Fill weekly stats
        document.getElementById("weekly-orders").innerText = data.weekly_orders;
        document.getElementById("weekly-sales").innerText = "₹" + data.weekly_sales;

        // Fill monthly stats
        document.getElementById("monthly-orders").innerText = data.monthly_orders;
        document.getElementById("monthly-sales").innerText = "₹" + data.monthly_sales;

        // Chart: Last 10 Days Orders
        renderOrdersChart(data.last_10_days);
      });

    function renderOrdersChart(last10Days) {
      const ctx = document.getElementById("ordersChart").getContext("2d");
      const labels = last10Days.map(item => item.date);
      const values = last10Days.map(item => item.count);

      new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [{
            label: "Orders",
            data: values,
            borderColor: "#4e73df",
            backgroundColor: "rgba(78, 115, 223, 0.1)",
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }
  });
</script>
{% endblock page_js %}

{% block content %}
<div class="row">
  <!-- Today's Orders -->
  <div class="col-md-6 col-xl-3 mb-4">
    <div class="card h-100 hover-shadow">
      <div class="card-body">
        <p class="mb-1">Today's Orders</p>
        <h4 class="card-title mb-2" id="today-orders">0</h4>
        <p class="text-muted mb-0">Sales: <span id="today-sales">₹0</span></p>
      </div>
    </div>
  </div>

  <!-- Weekly Orders -->
  <div class="col-md-6 col-xl-3 mb-4">
    <div class="card h-100 hover-shadow">
      <div class="card-body">
        <p class="mb-1">Weekly Orders</p>
        <h4 class="card-title mb-2" id="weekly-orders">0</h4>
        <p class="text-muted mb-0">Sales: <span id="weekly-sales">₹0</span></p>
      </div>
    </div>
  </div>

  <!-- Monthly Orders -->
  <div class="col-md-6 col-xl-3 mb-4">
    <div class="card h-100 hover-shadow">
      <div class="card-body">
        <p class="mb-1">Monthly Orders</p>
        <h4 class="card-title mb-2" id="monthly-orders">0</h4>
        <p class="text-muted mb-0">Sales: <span id="monthly-sales">₹0</span></p>
      </div>
    </div>
  </div>
</div>

<!-- Orders Trend Chart -->
<div class="card mt-4">
  <div class="card-header">
    <h5 class="mb-0">Orders Trend - Last 10 Days</h5>
  </div>
  <div class="card-body">
    <canvas id="ordersChart" height="120"></canvas>
  </div>
</div>
{% endblock %}
