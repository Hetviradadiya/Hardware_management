{% extends layout_path %} {% load static %} {% block title %}Hardware Shop -
Dashboard{% endblock %} {% block page_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // --- Fetch Stats ---
    fetch("/admin_api/hardware-dashboard-stats/")
      .then((res) => res.json())
      .then((data) => {
        document.getElementById("total-categories").innerText =
          data.total_categories;
        document.getElementById("total-products").innerText =
          data.total_products;
        document.getElementById("total-suppliers").innerText =
          data.total_suppliers;
        document.getElementById("total-customers").innerText =
          data.total_customers;
        document.getElementById("total-purchases").innerText =
          data.total_purchases;
        document.getElementById("low-stock-products").innerText =
          data.low_stock_products;
        document.getElementById("today-orders").innerText = data.today_orders;
        document.getElementById("total-sales-amount").innerText =
          "‚Çπ" + data.total_sales_amount;
        document.getElementById("total-inventory-value").innerText =
          "‚Çπ" + data.total_inventory_value;
        document.getElementById("monthly-orders").innerText = data.monthly_orders;
        document.getElementById("monthly-sales").innerText = "‚Çπ" + data.monthly_sales;
        document.getElementById("weekly-orders").innerText = data.weekly_orders;
        document.getElementById("weekly-sales").innerText = "‚Çπ" + data.weekly_sales;
        document.getElementById("total-variants").innerText = data.total_variants;
        document.getElementById("critical-stock").innerText = data.critical_stock_products;
        document.getElementById("out-of-stock").innerText = data.out_of_stock_products;

        renderOrdersChart(data.last_10_days_orders || []);
      });

    // --- Fetch Recent Data ---
    fetch("/admin_api/hardware-dashboard-data/")
      .then((res) => res.json())
      .then((data) => {
        renderRecentData("recent-products", data.recent_products, [
          "name",
          "category__name",
        ]);
        renderRecentData("recent-purchases", data.recent_purchases, [
          "date",
          "total_price",
          "supplier__name",
        ]);
        renderRecentData("recent-customers", data.recent_customers, [
          "name",
          "phone",
          "email",
        ]);
        renderRecentData("recent-suppliers", data.recent_suppliers, [
          "name",
          "phone",
          "email",
        ]);
        
        // Render new data sections
        renderRecentData("recent-orders", data.recent_orders, [
          "id",
          "order_date",
          "total_amount",
          "customer__name"
        ]);
        
        renderRecentData("top-products", data.top_products, [
          "product__name",
          "size",
          "total_sold",
          "order_count"
        ]);
        
        renderRecentData("low-stock-details", data.low_stock_items, [
          "variant__product__name",
          "variant__size", 
          "quantity"
        ]);
        
        // Render monthly sales chart
        if (data.monthly_sales_trend) {
          renderMonthlySalesChart(data.monthly_sales_trend);
        }
      });

    // --- Chart ---
    function renderOrdersChart(last10Days) {
      const ctx = document.getElementById("ordersChart").getContext("2d");
      const labels = Array.isArray(last10Days)
        ? last10Days.map((_, i) => `Day ${i + 1}`)
        : ["Last 10 Days"];
      const values = Array.isArray(last10Days)
        ? last10Days.map((v) => v.count || 0)
        : [last10Days];

      new Chart(ctx, {
        type: "bar",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Orders",
              data: values,
              backgroundColor: "rgba(78, 115, 223, 0.6)",
              borderColor: "#4e73df",
              borderWidth: 1,
              borderRadius: 8,
            },
          ],
        },
        options: {
          responsive: true,
          scales: { y: { beginAtZero: true } },
        },
      });
    }

    // --- Monthly Sales Chart ---
    function renderMonthlySalesChart(monthlyData) {
      const ctx = document.getElementById("monthlySalesChart").getContext("2d");
      const labels = monthlyData.map(item => item.month);
      const values = monthlyData.map(item => item.sales);

      new Chart(ctx, {
        type: "line",
        data: {
          labels: labels,
          datasets: [
            {
              label: "Monthly Sales (‚Çπ)",
              data: values,
              backgroundColor: "rgba(40, 167, 69, 0.1)",
              borderColor: "#28a745",
              borderWidth: 3,
              fill: true,
              tension: 0.4,
              pointBackgroundColor: "#28a745",
              pointBorderColor: "#fff",
              pointBorderWidth: 2,
              pointRadius: 6
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return '‚Çπ' + value.toLocaleString();
                }
              }
            }
          },
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          }
        },
      });
    }

    // --- Render Tables ---
    function renderRecentData(tableId, items, fields) {
      const tbody = document.getElementById(tableId);
      if (!tbody) return; // Skip if table doesn't exist
      
      tbody.innerHTML = "";

      if (!items || items.length === 0) {
        tbody.innerHTML = `<tr><td colspan="${fields.length}" class="text-center text-muted">No records found</td></tr>`;
        return;
      }

      items.forEach((item) => {
        const row = document.createElement("tr");
        fields.forEach((field) => {
          const cell = document.createElement("td");
          let value = item[field] ?? "-";
          
          // Format specific fields
          if (field.includes("date")) {
            value = new Date(value).toLocaleDateString();
          } else if (field.includes("amount") || field.includes("total_amount")) {
            value = "‚Çπ" + parseFloat(value).toLocaleString();
          } else if (field === "id") {
            value = "#" + value;
          }
          
          cell.textContent = value;
          row.appendChild(cell);
        });
        tbody.appendChild(row);
      });
    }
  });
</script>
{% endblock page_js %} {% block content %}
<style>
  .dashboard-card {
    border: none;
    border-radius: 1rem;
    color: #333;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  }
  .card-body i {
    font-size: 2rem;
    opacity: 0.8;
  }
  .card-body h4 {
    font-weight: bold;
    margin-top: 8px;
  }

  /* Light / pastel colors */
  .bg-blue {
    background: linear-gradient(135deg, #cfe2ff, #9ec5fe);
    color: #0d3c91;
  }
  .bg-green {
    background: linear-gradient(135deg, #d1f7dd, #a8e6a3);
    color: #0f5132;
  }
  .bg-orange {
    background: linear-gradient(135deg, #ffe5b4, #ffd580);
    color: #664d03;
  }
  .bg-red {
    background: linear-gradient(135deg, #ffd6d6, #ffabab);
    color: #7a1c1c;
  }
  .bg-teal {
    background: linear-gradient(135deg, #b2f0ea, #86e5de);
    color: #0d5f58;
  }
  .bg-purple {
    background: linear-gradient(135deg, #e3d7f5, #c7b3f0);
    color: #3f0f8a;
  }
  .bg-pink {
    background: linear-gradient(135deg, #fbcce7, #f8a6d9);
    color: #7a0b58;
  }
  .bg-dark {
    background: linear-gradient(135deg, #e2e3e5, #d6d8db);
    color: #212529;
  }

  .card.chart-card {
    border-radius: 1rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  .table th {
    background-color: #f8f9fc;
  }
  .recent-card {
    border-radius: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }
</style>

<div class="container-fluid">
  <!-- Summary Cards -->
  <div class="row g-4">
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-blue">
        <div class="card-body text-center">
          <i class="bi bi-tags-fill"></i>
          <p>Total Categories</p>
          <h4 id="total-categories">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-green">
        <div class="card-body text-center">
          <i class="bi bi-box-seam"></i>
          <p>Total Products</p>
          <h4 id="total-products">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-orange">
        <div class="card-body text-center">
          <i class="bi bi-truck"></i>
          <p>Total Suppliers</p>
          <h4 id="total-suppliers">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-purple">
        <div class="card-body text-center">
          <i class="bi bi-people-fill"></i>
          <p>Total Customers</p>
          <h4 id="total-customers">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-teal">
        <div class="card-body text-center">
          <i class="bi bi-bag-fill"></i>
          <p>Total Purchases</p>
          <h4 id="total-purchases">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-red">
        <div class="card-body text-center">
          <i class="bi bi-exclamation-triangle-fill"></i>
          <p>Low Stock Products</p>
          <h4 id="low-stock-products">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-pink">
        <div class="card-body text-center">
          <i class="bi bi-basket-fill"></i>
          <p>Today's Orders</p>
          <h4 id="today-orders">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-dark">
        <div class="card-body text-center">
          <i class="bi bi-currency-rupee"></i>
          <p>Total Sales Amount</p>
          <h4 id="total-sales-amount">‚Çπ0</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Additional Enhanced Stats -->
  <div class="row g-4 mt-3">
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-blue">
        <div class="card-body text-center">
          <i class="bi bi-safe"></i>
          <p>Total Inventory Value</p>
          <h4 id="total-inventory-value">‚Çπ0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-green">
        <div class="card-body text-center">
          <i class="bi bi-calendar-month"></i>
          <p>Monthly Orders</p>
          <h4 id="monthly-orders">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-orange">
        <div class="card-body text-center">
          <i class="bi bi-graph-up"></i>
          <p>Monthly Sales</p>
          <h4 id="monthly-sales">‚Çπ0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-purple">
        <div class="card-body text-center">
          <i class="bi bi-calendar-week"></i>
          <p>Weekly Orders</p>
          <h4 id="weekly-orders">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-teal">
        <div class="card-body text-center">
          <i class="bi bi-cash-stack"></i>
          <p>Weekly Sales</p>
          <h4 id="weekly-sales">‚Çπ0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-red">
        <div class="card-body text-center">
          <i class="bi bi-boxes"></i>
          <p>Product Variants</p>
          <h4 id="total-variants">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-pink">
        <div class="card-body text-center">
          <i class="bi bi-exclamation-circle-fill"></i>
          <p>Critical Stock</p>
          <h4 id="critical-stock">0</h4>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-xl-3">
      <div class="card dashboard-card bg-dark">
        <div class="card-body text-center">
          <i class="bi bi-x-circle-fill"></i>
          <p>Out of Stock</p>
          <h4 id="out-of-stock">0</h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Charts Section -->
  <div class="row mt-5">
    <div class="col-md-6">
      <div class="card chart-card">
        <div class="card-header bg-light">
          <h5 class="mb-0">üìä Orders Overview (Last 10 Days)</h5>
        </div>
        <div class="card-body"><canvas id="ordersChart" height="150"></canvas></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card chart-card">
        <div class="card-header bg-light">
          <h5 class="mb-0">üìà Monthly Sales Trend</h5>
        </div>
        <div class="card-body"><canvas id="monthlySalesChart" height="150"></canvas></div>
      </div>
    </div>
  </div>

  <!-- Recent Data Section -->
  <div class="row mt-5">
    <div class="col-md-6">
      <div class="card recent-card mb-4">
        <div class="card-header bg-light">
          <strong>üõí Recent Orders</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Date</th>
                <th>Amount</th>
                <th>Customer</th>
              </tr>
            </thead>
            <tbody id="recent-orders"></tbody>
          </table>
        </div>
      </div>
      <div class="card recent-card mb-4">
        <div class="card-header bg-light">
          <strong>üßæ Recent Purchases</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Total</th>
                <th>Supplier Name</th>
              </tr>
            </thead>
            <tbody id="recent-purchases"></tbody>
          </table>
        </div>
      </div>
      <div class="card recent-card">
        <div class="card-header bg-light">
          <strong>üßç Recent Customers</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
              </tr>
            </thead>
            <tbody id="recent-customers"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card recent-card mb-4">
        <div class="card-header bg-light">
          <strong>üèÜ Top Selling Products</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Size</th>
                <th>Sold Qty</th>
                <th>Orders</th>
              </tr>
            </thead>
            <tbody id="top-products"></tbody>
          </table>
        </div>
      </div>
      <div class="card recent-card mb-4">
        <div class="card-header bg-light">
          <strong>‚ö†Ô∏è Low Stock Items</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Size</th>
                <th>Stock</th>
              </tr>
            </thead>
            <tbody id="low-stock-details"></tbody>
          </table>
        </div>
      </div>
      <div class="card recent-card mb-4">
        <div class="card-header bg-light">
          <strong>üì¶ Recent Products</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Category</th>
              </tr>
            </thead>
            <tbody id="recent-products"></tbody>
          </table>
        </div>
      </div>
      <div class="card recent-card">
        <div class="card-header bg-light">
          <strong>üöö Recent Suppliers</strong>
        </div>
        <div class="card-body p-0">
          <table class="table mb-0">
            <thead>
              <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
              </tr>
            </thead>
            <tbody id="recent-suppliers"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Icons -->
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  rel="stylesheet"
/>
{% endblock %}
